import{t as E,h as k,u as $,r as N,f as y,d as v,k as A,j as e,p as D}from"./index-CRFdVEfv.js";const R=()=>{const P=E(),C=k(),{user:i}=$(),{userAnswers:u,exam:a}=P.state||{},{correctAnswersCount:f,earnedPoints:x,totalQuestions:p,percentage:h}=N.useMemo(()=>{if(!a)return{correctAnswersCount:0,earnedPoints:0,totalQuestions:0,percentage:0};let s=0,t=0;const c=a.questions.length;a.questions.forEach((r,g)=>{const m=u[g],o=r.correctAnswer;r.options.findIndex(d=>(typeof d=="string"?d:d.text)===m)===o&&(s++,t+=r.points||1)});const n=c>0?Math.round(s/c*100):0;return{correctAnswersCount:s,earnedPoints:t,totalQuestions:c,percentage:n}},[a,u]);return N.useEffect(()=>{if(i&&a){const s=y(v,"exam_results",a.id,"submissions",i.uid),t={email:i.email,userId:i.uid,percentage:h,correctAnswers:f,totalQuestions:p,earnedPoints:x,userAnswers:u,submittedAt:new Date};A(s,t,{merge:!0}).then(()=>console.log("Exam results saved successfully!")).catch(n=>console.error("Error saving exam results: ",n));const c=async()=>{const n=y(v,"users",i.uid);try{const m=((await D(n)).data()?.points||0)+x;await A(n,{points:m},{merge:!0}),console.log("User points updated successfully!")}catch(r){console.error("Error updating user points: ",r)}};x>0&&c()}},[i,a,h,f,p,x,u]),a?e.jsxs("div",{className:"py-4 flex-grow",children:[e.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-800 text-center mb-6",children:"نتائج الامتحان"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"p-6 bg-blue-100 text-blue-800 rounded-lg shadow-md text-center mb-8",children:[e.jsxs("p",{className:"text-2xl md:text-3xl font-bold",children:["لقد أجبت على ",f," من ",p," بشكل صحيح"]}),e.jsxs("p",{className:"text-xl md:text-2xl mt-2",children:["لقد حصلت على ",e.jsx("span",{className:"font-bold text-green-600",children:x})," نقطة"]}),e.jsxs("p",{className:"text-4xl md:text-5xl font-bold mt-2",children:[h,"%"]})]}),a.questions.map((s,t)=>{const c=u[t],n=s.correctAnswer,r=s.options.findIndex(o=>(typeof o=="string"?o:o.text)===c),g=r===n,m=s.points||1;return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md relative w-full",children:[e.jsx("div",{className:"question-number-box",children:e.jsx("span",{children:t+1})}),e.jsx("div",{className:"result-points-box",children:e.jsxs("span",{className:g?"text-black":"text-gray-500 line-through",children:[m," نقطة"]})}),e.jsx("p",{className:"text-lg md:text-xl text-gray-800 mb-4 break-words pt-16",children:s.text}),e.jsx("div",{className:"space-y-3",children:s.options.map((o,l)=>{const d=typeof o=="string"?o:o.text;let b="flex justify-between items-center p-2 rounded-lg",j="text-gray-700 text-base md:text-lg",w="";return l===n&&(b+=" bg-green-100",j="text-green-800 text-base md:text-lg font-bold",w='<i class="fas fa-check-circle text-green-600 ml-2"></i>'),r===l&&r!==n&&(b+=" bg-red-100",j="text-red-800 text-base md:text-lg font-bold",w='<i class="fas fa-times-circle text-red-600 ml-2"></i>'),e.jsxs("div",{className:b,children:[e.jsxs("div",{className:"custom-radio",children:[e.jsx("input",{type:"radio",id:`result-option-${t}-${l}`,name:`result-question-${t}`,value:d,className:"form-radio",checked:r===l,disabled:!0}),e.jsx("label",{htmlFor:`result-option-${t}-${l}`,className:j,children:d})]}),e.jsx("span",{dangerouslySetInnerHTML:{__html:w}})]},l)})})]},t)})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx("button",{onClick:()=>C("/"),className:"bg-gray-400 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-transform transform",children:"العودة إلى الامتحانات"})})]}):e.jsx("div",{children:"No results to display."})};export{R as default};
