import{r as a,j as e,u as w,b as S,c as j,o as M,e as P,d as x,s as C,f as k,g as q}from"./index-CRFdVEfv.js";const E=({isOpen:n,onClose:u,product:c,onSubmit:m})=>{const[l,i]=a.useState("whatsapp"),[r,h]=a.useState("");if(!n)return null;const d=t=>{if(t.preventDefault(),!r){alert("يرجى إدخال رقم الهاتف");return}m({contactMethod:l,phoneNumber:r})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md mx-4",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 text-right",children:["شراء ",c.name]}),e.jsxs("p",{className:"mb-6 text-right",children:["سعر المنتج: ",c.price," نقاط"]}),e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-right mb-2 font-bold",children:"طريقة التواصل"}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Telegram"}),e.jsx("input",{type:"radio",name:"contactMethod",value:"telegram",checked:l==="telegram",onChange:t=>i(t.target.value),className:"form-radio"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"WhatsApp"}),e.jsx("input",{type:"radio",name:"contactMethod",value:"whatsapp",checked:l==="whatsapp",onChange:t=>i(t.target.value),className:"form-radio"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"phoneNumber",className:"block text-right mb-2 font-bold",children:"رقم الهاتف"}),e.jsx("input",{type:"tel",id:"phoneNumber",value:r,onChange:t=>h(t.target.value),className:"w-full p-2 border border-gray-300 rounded-lg text-right",placeholder:"مثال: 966512345678+",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-gray-500 text-white font-bold py-2 px-4 rounded-lg",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg",children:"إرسال الطلب"})]})]})]})})},I=()=>{const{user:n}=w(),{points:u,loading:c}=S(),[m,l]=a.useState([]),[i,r]=a.useState(!0),[h,d]=a.useState(!1),[t,g]=a.useState(null);a.useEffect(()=>{const s=j(x,"products"),o=M(s,p=>{const v=p.docs.map(f=>({id:f.id,...f.data()}));l(v),r(!1)},p=>{console.error("Error fetching products:",p),r(!1)});return()=>o()},[]);const N=s=>{if(s.quantity<=0){alert("نفدت الكمية من هذا المنتج.");return}u<s.price?alert("ليس لديك نقاط كافية"):(g(s),d(!0))},b=()=>{d(!1),g(null)},y=async s=>{if(!(!n||!t))try{await P(j(x,"orders"),{userId:n.uid,userEmail:n.email,productId:t.id,productName:t.name,productPrice:t.price,contactMethod:s.contactMethod,phoneNumber:s.phoneNumber,status:"pending",createdAt:C()});const o=k(x,"products",t.id);await q(o,{quantity:t.quantity-1}),alert("تم إرسال طلبك بنجاح!")}catch(o){console.error("Error creating order or updating quantity:",o),alert("حدث خطأ أثناء إرسال طلبك.")}finally{b()}};return c||i?e.jsx("div",{className:"container mx-auto p-4 flex-grow flex justify-center items-center",children:e.jsx("div",{className:"spinner"})}):e.jsxs("div",{className:"container mx-auto p-4 flex-grow",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-10",children:m.map(s=>e.jsxs("div",{className:`bg-white rounded-lg shadow-md p-4 transition-transform 
                        ${s.quantity<=0?"opacity-60 cursor-not-allowed":"cursor-pointer hover:scale-105"}`,onClick:()=>N(s),children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:s.name}),e.jsxs("p",{className:"text-gray-700 text-lg mb-2",children:[s.price," نقطة"]}),s.quantity>0?e.jsxs("p",{className:"text-gray-500 text-sm",children:["الكمية المتاحة: ",s.quantity]}):e.jsx("p",{className:"text-red-500 font-bold text-sm",children:"نفدت الكمية"})]},s.id))}),t&&e.jsx(E,{isOpen:h,onClose:b,product:t,onSubmit:y})]})};export{I as default};
